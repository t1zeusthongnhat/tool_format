<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Formatter - Professional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .content {
            padding: 30px;
        }

        .editor-section {
            margin-bottom: 30px;
        }

        .editor-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .line-numbers {
            font-size: 0.85em;
            color: #666;
            font-weight: normal;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.3s;
            line-height: 1.6;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-format {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-format:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: #f44336;
            color: white;
        }

        .btn-clear:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .btn-copy {
            background: #4CAF50;
            color: white;
        }

        .btn-copy:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .options {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .options h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .option-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .option-item label {
            cursor: pointer;
            font-size: 0.95em;
        }

        .indent-size {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .indent-size input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß SQL Formatter Professional</h1>
            <p>Format SQL chu·∫©n chuy√™n nghi·ªáp - CƒÉn ch·ªânh AS t·ª± ƒë·ªông</p>
            <span class="badge">Made by: D∆∞∆°ng Ken</span>
        </div>

        <div class="content">
            <div class="options">
                <h3>‚öôÔ∏è T√πy ch·ªçn ƒë·ªãnh d·∫°ng:</h3>
                <div class="option-group">
                    <div class="option-item">
                        <input type="checkbox" id="optUppercase" checked>
                        <label for="optUppercase">Vi·∫øt hoa t·ª´ kh√≥a SQL</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="optAlignAs" checked>
                        <label for="optAlignAs">CƒÉn ch·ªânh AS</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="optColumnsNewline" checked>
                        <label for="optColumnsNewline">M·ªói c·ªôt m·ªôt d√≤ng</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="optRightAlignComma" checked>
                        <label for="optRightAlignComma">CƒÉn ch·ªânh d·∫•u ph·∫©y</label>
                    </div>
                    <div class="option-item indent-size">
                        <label for="indentSize">S·ªë space th·ª•t l·ªÅ:</label>
                        <input type="number" id="indentSize" min="2" max="8" value="7" style="width: 60px;">
                    </div>
                </div>
            </div>

            <div class="editor-section">
                <label class="editor-label">
                    <span>üìù Nh·∫≠p c√¢u SQL:</span>
                    <span class="line-numbers" id="inputLines">0 d√≤ng</span>
                </label>
                <textarea id="inputSql" placeholder="Nh·∫≠p ho·∫∑c paste c√¢u l·ªánh SQL c·ªßa b·∫°n v√†o ƒë√¢y..."></textarea>
            </div>

            <div class="button-group">
                <button class="btn-format" onclick="formatSql()">
                    ‚ú® Format SQL (Ctrl+Enter)
                </button>
                <button class="btn-clear" onclick="clearAll()">
                    üóëÔ∏è X√≥a t·∫•t c·∫£
                </button>
            </div>

            <div class="status" id="status"></div>

            <div class="editor-section" id="outputSection" style="display: none;">
                <label class="editor-label">
                    <span>‚úÖ K·∫øt qu·∫£ ƒë√£ format:</span>
                    <span class="line-numbers" id="outputLines">0 d√≤ng</span>
                </label>
                <textarea id="outputSql" readonly></textarea>
                <button class="btn-copy" onclick="copySql()" style="margin-top: 10px;">
                    üìã Copy k·∫øt qu·∫£
                </button>
            </div>
        </div>
    </div>

    <script>
        const SQL_KEYWORDS = [
            'SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'NOT', 'IN', 'BETWEEN', 'LIKE',
            'ORDER BY', 'GROUP BY', 'HAVING', 'LIMIT', 'OFFSET', 'AS',
            'INSERT INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE FROM',
            'JOIN', 'INNER JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'FULL JOIN', 'CROSS JOIN',
            'ON', 'DISTINCT', 'COUNT', 'SUM', 'AVG', 'MAX', 'MIN',
            'CASE', 'WHEN', 'THEN', 'ELSE', 'END',
            'UNION', 'UNION ALL', 'INTERSECT', 'EXCEPT',
            'EXISTS', 'ALL', 'ANY', 'SOME', 'IS NULL', 'IS NOT NULL',
            'ASC', 'DESC', 'CAST', 'BIT', 'NVARCHAR', 'VARCHAR', 'INT', 'DECIMAL',
            'RTRIM', 'LTRIM', 'TRIM'
        ];

        function updateLineCount() {
            const input = document.getElementById('inputSql');
            const lines = input.value.split('\n').length;
            document.getElementById('inputLines').textContent = lines + ' d√≤ng';
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        function formatSql() {
            const inputSql = document.getElementById('inputSql').value.trim();
            
            if (!inputSql) {
                showStatus('‚ùå Vui l√≤ng nh·∫≠p c√¢u SQL c·∫ßn format!', 'error');
                return;
            }

            const uppercase = document.getElementById('optUppercase').checked;
            const alignAs = document.getElementById('optAlignAs').checked;
            const columnsNewline = document.getElementById('optColumnsNewline').checked;
            const rightAlignComma = document.getElementById('optRightAlignComma').checked;
            const indentSize = parseInt(document.getElementById('indentSize').value) || 7;

            try {
                let formatted = inputSql;

                // Chu·∫©n h√≥a kho·∫£ng tr·∫Øng
                formatted = formatted.replace(/\s+/g, ' ').trim();

                // T√°ch c√°c ph·∫ßn c·ªßa c√¢u SELECT
                const selectMatch = formatted.match(/SELECT\s+(.*?)\s+FROM/i);
                const fromMatch = formatted.match(/FROM\s+(.*?)(?:\s+WHERE|\s+GROUP BY|\s+ORDER BY|\s*$)/i);
                const whereMatch = formatted.match(/WHERE\s+(.*?)(?:\s+GROUP BY|\s+ORDER BY|\s*$)/i);
                const groupMatch = formatted.match(/GROUP BY\s+(.*?)(?:\s+HAVING|\s+ORDER BY|\s*$)/i);
                const havingMatch = formatted.match(/HAVING\s+(.*?)(?:\s+ORDER BY|\s*$)/i);
                const orderMatch = formatted.match(/ORDER BY\s+(.*?)$/i);

                let result = '';
                const indent = ' '.repeat(indentSize);

                // X·ª≠ l√Ω SELECT
                if (selectMatch) {
                    result += (uppercase ? 'SELECT ' : 'select ');
                    
                    if (columnsNewline) {
                        const columns = selectMatch[1].split(',').map(c => c.trim());
                        
                        // T√¨m ƒë·ªô d√†i t·ªëi ƒëa c·ªßa ph·∫ßn tr∆∞·ªõc AS
                        let maxLengthBeforeAs = 0;
                        const columnParts = columns.map(col => {
                            const asMatch = col.match(/^(.*?)\s+AS\s+(.*)$/i);
                            if (asMatch && alignAs) {
                                const beforeAs = asMatch[1].trim();
                                maxLengthBeforeAs = Math.max(maxLengthBeforeAs, beforeAs.length);
                                return { beforeAs, afterAs: asMatch[2].trim(), hasAs: true };
                            }
                            return { full: col, hasAs: false };
                        });

                        // Format c√°c c·ªôt
                        columns.forEach((col, index) => {
                            const part = columnParts[index];
                            const isLast = index === columns.length - 1;
                            const comma = rightAlignComma ? '' : ',';
                            
                            if (part.hasAs && alignAs) {
                                const paddedBefore = part.beforeAs.padEnd(maxLengthBeforeAs, ' ');
                                const asKeyword = uppercase ? 'AS' : 'as';
                                if (rightAlignComma && !isLast) {
                                    result += `${paddedBefore} ${asKeyword} ${part.afterAs}\n${indent},`;
                                } else {
                                    result += `${paddedBefore} ${asKeyword} ${part.afterAs}${comma}`;
                                }
                            } else {
                                if (rightAlignComma && !isLast) {
                                    result += `${part.full}\n${indent},`;
                                } else {
                                    result += `${part.full}${comma}`;
                                }
                            }
                            
                            if (index < columns.length - 1) {
                                result += '\n' + indent;
                            }
                        });
                    } else {
                        result += selectMatch[1];
                    }
                }

                // X·ª≠ l√Ω FROM
                if (fromMatch) {
                    result += '\n' + (uppercase ? 'FROM ' : 'from ') + fromMatch[1].trim();
                }

                // X·ª≠ l√Ω WHERE
                if (whereMatch) {
                    const whereCondition = whereMatch[1].trim();
                    result += '\n' + (uppercase ? 'WHERE ' : 'where ');
                    
                    // X·ª≠ l√Ω AND/OR
                    let whereFormatted = whereCondition;
                    if (uppercase) {
                        whereFormatted = whereFormatted.replace(/\s+AND\s+/gi, ' AND ');
                        whereFormatted = whereFormatted.replace(/\s+OR\s+/gi, ' OR ');
                    }
                    
                    // Th√™m xu·ªëng d√≤ng cho AND/OR n·∫øu c√≥ nhi·ªÅu ƒëi·ªÅu ki·ªán
                    const conditions = whereFormatted.split(/\s+(AND|OR)\s+/i);
                    if (conditions.length > 1) {
                        result += '(' + conditions[0];
                        for (let i = 1; i < conditions.length; i += 2) {
                            const operator = uppercase ? conditions[i].toUpperCase() : conditions[i].toLowerCase();
                            result += ' ' + operator + ' ' + conditions[i + 1];
                        }
                        result += ')';
                    } else {
                        result += '(' + whereFormatted + ')';
                    }
                }

                // X·ª≠ l√Ω GROUP BY
                if (groupMatch) {
                    result += '\n' + (uppercase ? 'GROUP BY ' : 'group by ') + groupMatch[1].trim();
                }

                // X·ª≠ l√Ω HAVING
                if (havingMatch) {
                    result += '\n' + (uppercase ? 'HAVING ' : 'having ') + havingMatch[1].trim();
                }

                // X·ª≠ l√Ω ORDER BY
                if (orderMatch) {
                    result += '\n' + (uppercase ? 'ORDER BY ' : 'order by ') + orderMatch[1].trim();
                }

                // Vi·∫øt hoa c√°c t·ª´ kh√≥a SQL n·∫øu ƒë∆∞·ª£c ch·ªçn
                if (uppercase) {
                    SQL_KEYWORDS.forEach(keyword => {
                        const regex = new RegExp('\\b' + keyword + '\\b', 'gi');
                        result = result.replace(regex, keyword.toUpperCase());
                    });
                }

                document.getElementById('outputSql').value = result;
                document.getElementById('outputSection').style.display = 'block';
                
                const outputLines = result.split('\n').length;
                document.getElementById('outputLines').textContent = outputLines + ' d√≤ng';
                
                showStatus('‚úÖ Format th√†nh c√¥ng! (' + outputLines + ' d√≤ng)', 'success');
            } catch (error) {
                showStatus('‚ùå L·ªói: ' + error.message, 'error');
                console.error('Chi ti·∫øt l·ªói:', error);
            }
        }

        function clearAll() {
            document.getElementById('inputSql').value = '';
            document.getElementById('outputSql').value = '';
            document.getElementById('outputSection').style.display = 'none';
            document.getElementById('status').style.display = 'none';
            updateLineCount();
        }

        function copySql() {
            const output = document.getElementById('outputSql');
            output.select();
            document.execCommand('copy');
            showStatus('‚úÖ ƒê√£ copy v√†o clipboard!', 'success');
        }

        // Cho ph√©p format b·∫±ng Ctrl+Enter
        document.getElementById('inputSql').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                formatSql();
            }
        });

        // C·∫≠p nh·∫≠t s·ªë d√≤ng khi g√µ
        document.getElementById('inputSql').addEventListener('input', updateLineCount);

        // Kh·ªüi t·∫°o
        updateLineCount();
    </script>
</body>
</html>